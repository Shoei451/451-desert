<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="../images/favicon-solar.png" />
  <title>calendar mini app — 451-Solarized</title>
  <link rel="stylesheet" href="../css/solar-calendar-style.css" />
</head>

<body>
  <!-- Main App -->
  <div class="app" id="mainApp">
    <header>
      <div class="brand" aria-label="アプリ名">
        <div class="logo">✏️</div>
        <h1>学生用カレンダー <span class="hint"><br>課題/試験/授業を一括管理</span></h1>
      </div>
      
      <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
        <div class="user-info">
          <span id="userEmail"></span>
        </div>
        <div class="sync-status" id="syncStatus">
          <span class="loading-spinner"></span>
          <span>同期中...</span>
        </div>
        <button id="theme-toggle" title="テーマ切替">
          <svg id="moon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
          </svg>
          <svg id="sun" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
          </svg>
        </button>
        <button id="logoutBtn" class="danger">Log out</button>
      </div>
      
      <div class="controls">
        <div class="row-nav">
          <button id="prevBtn" title="前の月">◀</button>
          <button id="nextBtn" title="次の月">▶</button>
          <select id="monthSelect" title="月"></select>
          <select id="yearSelect" title="年"></select>
          <button id="todayBtn" class="ghost">今日</button>
        </div>
        <div class="row-action">
          <button id="addBtn" class="primary">＋ 予定を追加</button>
          <button id="exportPdfBtn" class="primary">PDF Export</button>
        </div>
        <div class="row-export">
          <button id="exportBtn" class="ghost">Export</button>
          <label class="ghost" style="
          padding:12px 14px; 
          cursor:pointer; 
          border: #aaaaaa 2px solid;
          border-radius:12px; 
          display:inline-flex; 
          align-items:center; 
          min-height:48px;">
            Import File
            <input type="file" id="importFile" accept="application/json" hidden>
          </label>
        </div>
        <div class="row-danger">
          <button id="clearBtn" class="warn" title="全データ削除">全消去</button>
        </div>
      </div>
    </header>

    <div class="grid">
      <section class="panel">
        <div class="panel-header">
          <div class="legend" id="legend"></div>
          <div class="hint">クリックで日付に予定を追加／予定を編集</div>
        </div>
        <div id="calendar" class="calendar" aria-label="カレンダー"></div>
      </section>

      <aside class="panel">
        <div class="panel-header">
          <strong>ダッシュボード</strong>
          <div class="flex">
            <select id="filterCourse">
              <option value="">すべての科目</option>
            </select>
            <select id="filterType">
              <option value="">すべての種類</option>
              <option>時程変更</option>
              <option>課題提出日</option>
              <option>試験</option>
              <option>定期試験 / 学校模試</option>
              <option>東進模試</option>
              <option>部活動</option>
              <option>長期休み</option>
              <option>その他</option>
            </select>
          </div>
        </div>
        <div class="panel-body">
          <div class="kpi">
            <div class="card">
              <div class="lbl">今月の予定</div>
              <div id="kpiTotal" class="num">0</div>
            </div>
            <div class="card">
              <div class="lbl">全体の予定</div>
              <div id="kpiAll" class="num">0</div>
            </div>
            <div class="card">
              <div class="lbl">近日（7日）</div>
              <div id="kpiSoon" class="num">0</div>
            </div>
          </div>
          <h3>近日の締切</h3>
          <div id="upcoming" class="list"></div>
        </div>
      </aside>
    </div>
  </div>

  <dialog id="eventModal">
    <form method="dialog" id="eventForm">
      <div class="modal-head">
        <strong id="modalTitle">予定を追加</strong>
        <div class="flex">
          <button type="button" value="cancel" onclick="eventModal.close()">閉じる</button>
          <button id="deleteBtn" class="danger" type="button" style="display:none">削除</button>
          <button id="saveBtn" class="primary" type="submit">保存</button>
        </div>
      </div>
      <div class="modal-body">
        <input type="hidden" id="eventId">
        <input type="hidden" id="groupId">
        
        <div id="groupWarning" style="display:none; background:#fff3cd; color:#856404; padding:12px; border-radius:8px; margin-bottom:16px; font-size:13px;"></div>
        
        <div class="row">
          <label>タイトル
            <input id="title" required placeholder="例: 英語課題 Unit5 提出">
          </label>
          <label id="courseLabel">科目（自由入力）
            <input id="course" list="courseList" placeholder="例: 英語">
            <datalist id="courseList"></datalist>
          </label>
        </div>
        <div class="row">
          <label>日付
            <input id="date" type="date" required>
          </label>
          <label>
            <input type="checkbox" id="multiDate" style="width:auto; margin-right:8px">
            複数日に登録
          </label>
        </div>
        <div class="row">
          <label>開始時刻（任意）
            <input id="start" type="time" placeholder="例: 09:00">
          </label>
          <label>終了時刻（任意）
            <input id="end" type="time" placeholder="例: 17:00">
          </label>
        </div>
        <div class="row" id="endDateRow" style="display:none">
          <label>終了日（複数日登録時）
            <input id="endDate" type="date">
          </label>
        </div>
        <div class="row">
          <label>種類
            <select id="type">
              <option>時程変更</option>
              <option>課題提出日</option>
              <option>試験</option>
              <option>定期試験 / 学校模試</option>
              <option>東進模試</option>
              <option>部活動</option>
              <option>長期休み</option>
              <option>その他</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>メモ
            <textarea id="notes" rows="3" placeholder="必要な持ち物／提出方法など"></textarea>
          </label>
        </div>
        <div class="hint" id="multiDateHint" style="display:none; color:var(--brand); font-weight:600">
          ✓ 複数日に同じ予定を登録します（開始日〜終了日の各日に個別の予定として作成）
        </div>
      </div>
    </form>
  </dialog>
  <script src="calendar-app-logic.js" type="module"></script>
</body>
</html>